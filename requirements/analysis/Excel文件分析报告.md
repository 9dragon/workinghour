# 工时日志 Excel 文件分析报告

## 一、文件基本信息

- **文件名**: 工时日志 V4.1-20260105111747.xlsx
- **文件路径**: `D:\work\projects\workinghour\requirements\工时日志 V4.1-20260105111747.xlsx`
- **总列数**: 49
- **总行数**: 1516（含表头）
- **数据行数**: 1514

---

## 二、表头结构分析

### 2.1 两层表头结构

该 Excel 文件采用**两层表头**结构：

1. **第1行（工时大类）**: 定义工时的主要分类
   - 例如：【项目交付工时】、【产研项目工时】、【售前支持工时】等

2. **第2行（具体字段）**: 定义每个大类下的详细字段
   - 例如：项目经理、项目名称、工作时长、加班时长等

3. **基础列**: 第1行为空的列，表示这些列是基础信息，不属于任何工时大类

### 2.2 表头层级关系

| 列号 | 第1行（大类） | 第2行（具体字段） | 合并后字段名 |
|------|--------------|-----------------|-------------|
| 1-11 | (空) | 序号、姓名、时间等 | 基础信息 |
| 12-17 | 【项目交付工时】 | 项目经理、项目名称、工作时长等 | 项目交付-xxx |
| 18-23 | 【产研项目工时】 | 项目经理、项目名称、工作时长等 | 产品-xxx |
| 24-29 | 【售前支持工时】 | 审批人、项目名称、工作时长等 | 售前-xxx |
| 30-35 | 【部门内务工时】 | 部门、项目名称、工作时长等 | 部门-xxx |
| 36-37 | 【请假记录】 | 请假类别、请假时长 | 请假相关 |
| 38-49 | (空) | 审批编号、审批结果等 | 审批流程信息 |

---

## 三、完整字段清单

### 3.1 基础信息字段（列1-11）

| 列号 | 字段名 | 说明 | 示例 |
|------|--------|------|------|
| 1 | 序号 | 记录序号 | 1, 2, 3 |
| 2 | 数据id | 钉钉系统唯一标识ID | 9cq1A0kPQv-k4X5dv4AuzQ02531767575599 |
| 3 | 姓名 | 员工姓名 | 白学胜 |
| 4 | 开始时间 | 工时周期开始日期 | 2025-12-29 |
| 5 | 结束时间 | 工时周期结束日期 | 2026-01-04 |
| 6 | 工作摘要/本周复盘 | 本周工作总结 | 1. 元旦前准备... |
| 7 | 下周计划 | 下周工作计划 | 1. 元旦安排... |
| 8 | 所需支持 | 需要什么支持 | (文本内容) |
| 9 | 附件 | 附件文件 | (文件名) |
| 10 | 当前时间 | 填写时间 | (时间戳) |
| 11 | 当前地点 | 填写地点 | (地点) |

### 3.2 项目交付工时（列12-17）

| 列号 | 字段名 | 说明 | 数据类型 |
|------|--------|------|---------|
| 12 | 项目交付-项目经理 | 项目负责人 | 文本 |
| 13 | 项目交付-项目名称 | 项目名称 | 文本 |
| 14 | **项目交付-工作时长** | **工作时长（小时）** | **数值** |
| 15 | **项目交付-加班时长** | **加班时长（小时）** | **数值** |
| 16 | 项目交付-工作内容 | 具体工作内容描述 | 文本 |
| 17 | 项目交付-备注 | 备注信息 | 文本 |

### 3.3 产研项目工时（列18-23）

| 列号 | 字段名 | 说明 | 数据类型 |
|------|--------|------|---------|
| 18 | 产品-项目经理 | 产品经理 | 文本 |
| 19 | 产品-项目名称 | 产品/项目名称 | 文本 |
| 20 | **产品-工作时长** | **工作时长（小时）** | **数值** |
| 21 | **产品-加班时长** | **加班时长（小时）** | **数值** |
| 22 | 产品-研发工作内容 | 研发工作内容描述 | 文本 |
| 23 | 产品-备注 | 备注信息 | 文本 |

### 3.4 售前支持工时（列24-29）

| 列号 | 字段名 | 说明 | 数据类型 |
|------|--------|------|---------|
| 24 | 售前-审批人 | 售前审批人 | 文本 |
| 25 | 售前-项目名称 | 售前项目名称 | 文本 |
| 26 | **售前-工作时长** | **工作时长（小时）** | **数值** |
| 27 | **售前-加班时长** | **加班时长（小时）** | **数值** |
| 28 | 售前-工作内容 | 售前工作内容描述 | 文本 |
| 29 | 售前-备注 | 备注信息 | 文本 |

### 3.5 部门内务工时（列30-35）

| 列号 | 字段名 | 说明 | 数据类型 |
|------|--------|------|---------|
| 30 | 部门 | 部门名称 | 文本 |
| 31 | 部门-项目名称 | 内务项目名称 | 文本 |
| 32 | **部门-工作时长** | **工作时长（小时）** | **数值** |
| 33 | **部门-加班时长** | **加班时长（小时）** | **数值** |
| 34 | 部门-内务工作内容 | 内务工作内容描述 | 文本 |
| 35 | 部门-备注 | 备注信息 | 文本 |

### 3.6 请假记录（列36-37）

| 列号 | 字段名 | 说明 | 数据类型 |
|------|--------|------|---------|
| 36 | 请假类别 | 请假类型（如年假、事假等） | 文本 |
| 37 | **请假时长** | **请假时长（小时）** | **数值** |

### 3.7 审批流程字段（列38-49）

| 列号 | 字段名 | 说明 | 数据类型 | 示例 |
|------|--------|------|---------|------|
| 38 | 审批编号 | 审批系统编号 | 文本 | 202601050913000197326 |
| 39 | 创建时间 | 审批单创建时间 | 日期时间 | 2026-01-05 09:13:19 |
| 40 | 创建人 | 审批单创建人 | 文本 | 白学胜 |
| 41 | 当前负责人 | 当前审批负责人 | 文本 | (姓名) |
| **42** | **审批结果** | **审批结果（通过/驳回）** | **文本** | **审批通过 / --** |
| **43** | **审批状态** | **审批状态（已完成/进行中）** | **文本** | **已结束 / 终止** |
| 44 | 更新时间 | 最后更新时间 | 日期时间 | 2026-01-05 09:19:49 |
| 45 | 创建人部门 | 创建人所属部门 | 文本 | 产品设计组 |
| 46 | 审批单标题 | 审批单标题 | 文本 | 白学胜提交的工时日志 V4.1 |
| 47 | 历史审批人 | 历史审批人列表 | 文本 | (姓名列表) |
| 48 | 耗时(时:分:秒) | 审批耗时 | 时间 | 0:6:31 |
| 49 | 审批记录 | 详细审批记录 | 文本 | (审批历史) |

---

## 四、工时字段命名规则分析

### 4.1 工时大类分类

Excel 文件将工时分为 **5 个主要类别**：

1. **【项目交付工时】**: 项目交付类工作
   - 用于外部项目交付相关的工时记录
   - 包含：项目经理、项目名称、工作时长、加班时长、工作内容、备注

2. **【产研项目工时】**: 产品研发类工作
   - 用于内部产品研发相关的工时记录
   - 包含：项目经理、项目名称、工作时长、加班时长、研发工作内容、备注

3. **【售前支持工时】**: 售前支持类工作
   - 用于售前支持相关的工时记录
   - 包含：审批人、项目名称、工作时长、加班时长、工作内容、备注

4. **【部门内务工时】**: 部门内部管理类工作
   - 用于部门内部管理、培训、会议等工时记录
   - 包含：部门、项目名称、工作时长、加班时长、内务工作内容、备注

5. **【请假记录】**: 请假类记录
   - 用于各类请假记录
   - 包含：请假类别、请假时长

### 4.2 每个工时大类的标准字段结构

每个工时大类（除请假外）都包含以下标准字段：

| 字段类型 | 项目交付 | 产研项目 | 售前支持 | 部门内务 |
|---------|---------|---------|---------|---------|
| 负责人 | 项目经理 | 项目经理 | 审批人 | 部门 |
| 项目名称 | ✓ | ✓ | ✓ | ✓ |
| 工作时长 | ✓ | ✓ | ✓ | ✓ |
| 加班时长 | ✓ | ✓ | ✓ | ✓ |
| 工作内容 | ✓ | 研发工作内容 | ✓ | 内务工作内容 |
| 备注 | ✓ | ✓ | ✓ | ✓ |

### 4.3 字段命名模式

**命名格式**: `{工时大类}-{具体字段}`

**示例**:
- `项目交付-工作时长`
- `产品-加班时长`
- `售前-项目名称`
- `部门-工作时长`

### 4.4 所有工时相关列汇总

**共 9 个工时相关列**：

| 列号 | 字段名 | 工时类型 | 数据类型 |
|------|--------|---------|---------|
| 14 | 项目交付-工作时长 | 工作时长 | 数值 |
| 15 | 项目交付-加班时长 | 加班时长 | 数值 |
| 20 | 产品-工作时长 | 工作时长 | 数值 |
| 21 | 产品-加班时长 | 加班时长 | 数值 |
| 26 | 售前-工作时长 | 工作时长 | 数值 |
| 27 | 售前-加班时长 | 加班时长 | 数值 |
| 32 | 部门-工作时长 | 工作时长 | 数值 |
| 33 | 部门-加班时长 | 加班时长 | 数值 |
| 37 | 请假时长 | 请假时长 | 数值 |

---

## 五、实际数据样例分析

### 5.1 样例数据1（项目交付工时 + 请假）

```
序号: 1
姓名: 白学胜
开始时间: 2025-12-29
结束时间: 2026-01-04

项目交付工时:
  - 项目经理: 张梅
  - 项目名称: D4086中集圣达因交付周期
  - 工作时长: 8 小时
  - 加班时长: (空)

产研项目工时:
  - 工作时长: 0 小时

售前支持工时:
  - 工作时长: 0 小时

部门内务工时:
  - 部门: 产品设计组
  - 工作时长: 0 小时

请假记录:
  - 请假类别: 年休假
  - 请假时长: 24 小时

审批状态:
  - 审批结果: 审批通过
  - 审批状态: 已结束
```

**分析**:
- 这是一条**混合数据**，同时包含项目交付工时和请假记录
- 项目交付工时 8 小时，请假 24 小时
- 审批通过且已结束，**符合导入条件**

### 5.2 样例数据2（被驳回的记录）

```
序号: 2
姓名: 白学胜
开始时间: 2025-12-29
结束时间: 2025-12-31

项目交付工时:
  - 项目经理: 张梅
  - 项目名称: D4086中集圣达因交付周期
  - 工作时长: 8 小时

请假记录:
  - 请假类别: 年休假
  - 请假时长: 24 小时

审批状态:
  - 审批结果: --
  - 审批状态: 终止
```

**分析**:
- 审批状态为"终止"，**不符合导入条件**
- 需要过滤掉此类记录

### 5.3 样例数据3（部门内务工时）

```
序号: 3
姓名: 范纪
开始时间: 2025-12-29
结束时间: 2026-01-04

项目交付工时:
  - 工作时长: 0 小时

产研项目工时:
  - 工作时长: 0 小时

售前支持工时:
  - 工作时长: 0 小时

部门内务工时:
  - 部门: 项目交付部
  - 项目名称: A工程中心
  - 工作时长: 24 小时

请假记录:
  - (空)

审批状态:
  - 审批结果: 审批通过
  - 审批状态: 已结束
```

**分析**:
- 只有部门内务工时 24 小时
- 其他工时类型为 0 或空
- 审批通过且已结束，**符合导入条件**

---

## 六、数据导入关键注意事项

### 6.1 审批状态筛选（重要）

**仅导入以下条件的记录**：
- ✅ **审批结果** = "审批通过"（列42）
- ✅ **审批状态** = "已结束"（列43）

**过滤掉以下记录**：
- ❌ 审批结果 = "--" 或其他非"通过"值
- ❌ 审批状态 = "终止" 或其他非"已结束"值

### 6.2 唯一性标识

**使用以下组合作为唯一性标识**：
```
序号 + 姓名 + 开始时间 + 项目名称
```

**注意事项**：
- 由于一条记录可能包含多个项目名称（不同工时类型），需要为每个有工时的项目创建独立的数据行
- 例如：一条记录同时有项目交付工时和产研项目工时，应拆分为 2 条数据，每条都有独立的唯一性标识

### 6.3 工时数据拆分处理

**问题**: 一条记录可能包含多种工时类型

**解决方案**: 将不同工时类型拆分为独立的数据行

**示例**:

原始记录：
```
姓名: 张三
项目交付-项目名称: 项目A
项目交付-工作时长: 8
产品-项目名称: 产品B
产品-工作时长: 4
```

拆分后：
```
记录1:
  姓名: 张三
  项目名称: 项目A
  工作类型: 项目交付
  工作时长: 8

记录2:
  姓名: 张三
  项目名称: 产品B
  工作类型: 产研项目
  工作时长: 4
```

### 6.4 空值处理规则

| 字段类型 | 空值处理 | 说明 |
|---------|---------|------|
| 工作时长 = 0 | **不创建数据行** | 表示该类型无工时，不记录 |
| 工作时长为空 | **不创建数据行** | 同上 |
| 项目名称为空 | **不创建数据行** | 必须有项目名称才记录 |
| 加班时长为空 | 设为 0 | 可选字段，空值表示无加班 |
| 工作内容为空 | 保留空字符串 | 可选字段 |

### 6.5 数据类型转换

| 字段名 | 原始类型 | 目标类型 | 转换规则 |
|--------|---------|---------|---------|
| 工作时长 | 数值/文本 | Float | 转为浮点数，空值→0 |
| 加班时长 | 数值/文本 | Float | 转为浮点数，空值→0 |
| 开始时间 | 日期 | Date | 解析为日期对象 |
| 结束时间 | 日期 | Date | 解析为日期对象 |
| 审批结果 | 文本 | String | 标准化（去空格） |
| 审批状态 | 文本 | String | 标准化（去空格） |

---

## 七、与需求规格书的映射关系

### 7.1 核心工时字段映射

| 需求规格书字段 | Excel 列 | 说明 |
|--------------|---------|------|
| 序号 | 列1 | 直接映射 |
| 姓名 | 列3 | 直接映射 |
| 开始时间 | 列4 | 直接映射 |
| 结束时间 | 列5 | 直接映射 |
| 项目名称 | 列13/19/25/31 | 根据工时类型选择 |
| 工作时长 | 列14/20/26/32 | 根据工时类型选择 |
| 加班时长 | 列15/21/27/33 | 根据工时类型选择 |
| 工作内容 | 列16/22/28/34 | 根据工时类型选择 |
| 部门名称 | 列30 | 部门内务的部门 |

### 7.2 需要额外处理的字段

| 字段 | 处理方式 |
|------|---------|
| 工作类型 | 根据 Excel 列位置自动识别（项目交付/产研项目/售前支持/部门内务） |
| 项目经理 | 列12（项目交付）或列18（产研项目）或列24（售前） |
| 审批编号 | 列38 |
| 审批结果 | 列42，用于筛选 |
| 审批状态 | 列43，用于筛选 |

---

## 八、总结与建议

### 8.1 Excel 文件结构特点

1. ✅ **结构清晰**: 采用两层表头，分类明确
2. ✅ **字段完整**: 包含工时统计所需的所有关键字段
3. ⚠️ **复杂度高**: 一条记录可能包含多种工时类型，需要拆分处理
4. ⚠️ **数据量大**: 1514 条数据，需要优化处理性能

### 8.2 实现建议

1. **数据预处理**
   - 先根据审批状态筛选符合条件的记录
   - 读取两层表头，构建字段映射关系
   - 识别每条记录包含的工时类型

2. **数据拆分策略**
   - 遍历每条记录，检查 4 种工时类型的工作时长
   - 为工作时长 > 0 的工时类型创建独立数据行
   - 生成唯一的组合键（序号+姓名+开始时间+项目名称）

3. **性能优化**
   - 使用 pandas 批量处理数据
   - 建立索引，加速唯一性检查
   - 使用事务批量插入数据库

4. **数据校验**
   - 校验必填字段（序号、姓名、项目名称、工作时长）
   - 校验数值范围（工作时长 > 0）
   - 校验日期逻辑（结束时间 >= 开始时间）

### 8.3 后续扩展

如果未来需要支持更多工时类型，Excel 结构可以方便地扩展：
- 新增工时大类：在第一行添加新的【xxx工时】列
- 新增字段：在对应的工时大类下添加子字段
- 程序代码：只需配置字段映射关系，无需修改核心逻辑

---

## 附录：相关文件路径

- **Excel 原文件**: `D:\work\projects\workinghour\requirements\工时日志 V4.1-20260105111747.xlsx`
- **字段清单**: `D:\work\projects\workinghour\excel_analysis.txt`
- **详细字段说明**: `D:\work\projects\workinghour\excel_fields_detailed.txt`
- **样例数据**: `D:\work\projects\workinghour\excel_sample_data.txt`
- **分析脚本**: `D:\work\projects\workinghour\analyze_excel.py`

---

**生成时间**: 2026-01-23
**分析工具**: Python + openpyxl
