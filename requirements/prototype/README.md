# 原型说明

## 目录结构

```
prototype/
├── frontend/          # AI 生成的前端原型代码
└── README.md          # 本文档
```

## 用途

本目录存放通过 AI 自动生成的前端原型代码，主要用于：

- **需求验证** - 直观展示需求对应的界面效果
- **UI/UX 设计参考** - 提供界面布局、配色、交互的视觉参考
- **沟通协作** - 方便产品、设计、开发团队就需求达成共识
- **实现规范** - 为正式开发提供样式和交互行为的参考基准

## 使用规则

### ⚠️ 重要说明

1. **原型仅供参考** - 原型代码是需求验证的工具，不直接合并到正式代码
2. **参考而非复制** - 开发者应参照原型的**视觉、交互、业务逻辑**进行实现，而非简单复制
3. **质量要求** - 正式代码需遵循项目的架构规范、编码标准和最佳实践
4. **功能对标** - 正式实现应复刻原型的核心功能模块和交互体验

## 开发阶段使用指南

### 1. 开发前准备

#### 环境要求

| 组件 | 版本要求 |
|------|----------|
| Node.js | >= 18.x (推荐 18.20.3 LTS) |
| npm | >= 9.x |

#### 多版本 Node 管理

如需与其他项目共存，推荐使用 **nvm-windows** 管理多版本：

```bash
# 切换到 Node.js 18
nvm use 18.20.3

# 查看已安装版本
nvm list
```

#### 安装与运行

```bash
# 查看原型效果
cd requirements/prototype/frontend
npm install
npm run dev
```

访问 `http://localhost:3000` 查看原型效果。

### 1.1 模拟登录模式

前端原型已启用**模拟模式**，无需后端 API 即可体验完整功能。

#### 登录凭据

| 用户名 | 密码 | 角色 |
|--------|------|------|
| admin | 任意（≥6位） | 管理员 |
| user | 任意（≥6位） | 普通用户 |
| 其他任意 | 任意（≥6位） | 普通用户 |

#### 模拟数据范围

| 功能模块 | 模拟数据 |
|----------|----------|
| 数据导入 | 返回模拟导入结果（100行，95成功，3重复，2无效） |
| 项目查询 | 返回2条模拟工时记录 |
| 组织查询 | 返回2条模拟工时记录 |
| 完整性检查 | 返回模拟缺失工时统计 |
| 合规性检查 | 返回模拟异常工时数据 |
| 导入记录 | 返回2条历史导入批次记录 |

#### 关闭模拟模式

修改 `src/utils/request.js`：
```javascript
const MOCK_MODE = false  // 改为 false
```

关闭后需启动后端服务才能正常使用。

### 2. 开发参考

从原型中提取以下信息：

| 类别 | 参考内容 | 说明 |
|------|----------|------|
| **视觉规范** | 配色方案、字体、间距、布局 | 参考 CSS 变量和样式定义 |
| **组件设计** | 按钮、表单、卡片等 UI 组件 | 参考组件的结构和样式 |
| **页面流程** | 页面跳转、导航结构 | 参考路由配置和页面组织 |
| **交互逻辑** | 表单验证、状态切换、反馈提示 | 参考 JavaScript 逻辑实现 |
| **业务流程** | 工时录入、数据统计等核心功能 | 参考数据处理和状态管理 |

### 3. 对比验证

开发完成后，建议进行以下对比：

- [ ] 视觉效果对比 - 将实现页面与原型并排对比
- [ ] 功能核对 - 逐项检查原型中的功能点是否实现
- [ ] 交互验证 - 测试交互行为是否与原型一致

## 原型生成信息

| 项目 | 说明 |
|------|------|
| 生成工具 | Claude Code AI 辅助生成 |
| 生成日期 | 2026-01-15 |
| 对应需求 | [需求规格书](../需求规格书.md) |
| 架构设计 | [架构设计说明书](../架构设计说明书.md) |

## 原型功能列表

已生成的原型包含以下完整功能模块：

### 1. 用户认证
- 登录页面（Login.vue）
- 路由守卫（未登录拦截）
- JWT 令牌管理（localStorage）

### 2. 数据管理
- Excel 数据导入页面（DataImport.vue）
  - 文件拖拽上传
  - 重复数据处理策略选择
  - 导入结果展示
  - 导入报告查看与导出
- 导入记录查看页面（ImportRecords.vue）
  - 历史批次查询
  - 批次详情查看
  - 报告下载

### 3. 工时查询
- 项目维度查询页面（ProjectQuery.vue）
  - 项目名称/经理筛选
  - 时间范围筛选
  - 排序功能
  - 汇总统计
  - 结果导出
- 组织维度查询页面（OrganizationQuery.vue）
  - 部门/人员筛选
  - 时间范围筛选
  - 排序功能
  - 汇总统计
  - 结果导出

### 4. 工时核对
- 完整性检查页面（IntegrityCheck.vue）
  - 时间范围/部门/人员筛选
  - 工作日定义配置
  - 缺失工时记录统计
  - 缺失明细展示
  - 核对报告导出
- 合规性检查页面（ComplianceCheck.vue）
  - 合规规则配置（工时下限、加班上限等）
  - 异常数据统计
  - 异常类型分布
  - 异常明细展示
  - 核对报告导出
- 核对历史记录页面（CheckHistory.vue）
  - 历史核对记录查询
  - 核对详情查看
  - 历史报告下载

### 5. 系统设置
- 系统设置页面（SystemSettings.vue）
  - 数据备份与恢复
  - 系统配置管理
  - 系统信息展示

## 技术栈

- **前端框架**: Vue.js 3 (Composition API)
- **构建工具**: Vite
- **UI 组件库**: Element Plus 2.4.x
- **HTTP 客户端**: Axios
- **状态管理**: Pinia
- **日期处理**: Day.js

## 项目结构

```
frontend/
├── src/
│   ├── api/              # API 接口封装
│   ├── components/       # 公共组件
│   ├── router/           # 路由配置
│   ├── store/            # Pinia 状态管理
│   ├── utils/            # 工具函数
│   ├── views/            # 页面组件
│   ├── App.vue           # 根组件
│   └── main.js           # 入口文件
├── index.html            # HTML 模板
├── vite.config.js        # Vite 配置
└── package.json          # 项目依赖
```

## API 实现说明

### 双模式设计

前端原型采用**模拟模式 + 实际模式**的双模式设计，通过开关控制：

| 模式 | 设置 | 说明 |
|------|------|------|
| 模拟模式 | `MOCK_MODE = true` | 无需后端，直接返回模拟数据 |
| 实际模式 | `MOCK_MODE = false` | 发送 HTTP 请求到后端 API |

**实现位置**：`src/api/index.js`

```javascript
const MOCK_MODE = true  // 模拟模式开关

export async function login(data) {
  if (MOCK_MODE) {
    // 模拟实现 - 直接返回 Promise
    return Promise.resolve({ code: 200, message: '登录成功', data: {...} })
  } else {
    // 真实 API - 通过 request.js 发送 HTTP 请求
    return request.post('/auth/login', data)
  }
}
```

### API 接口列表

所有 API 接口定义在 **`src/api/index.js`**：

| 模块 | 接口 | 功能 |
|------|------|------|
| **用户认证** | `login()` | 用户登录，返回 token 和用户信息 |
| **数据管理** | `importExcel()` | Excel 数据导入 |
| | `getImportRecords()` | 获取导入记录列表 |
| | `getImportDetail()` | 获取导入批次详情 |
| | `downloadImportReport()` | 下载导入报告 |
| **工时查询** | `queryByProject()` | 项目维度查询 |
| | `queryByOrganization()` | 组织维度查询 |
| | `exportQueryResult()` | 导出查询结果 |
| | `getDataDict()` | 获取数据字典 |
| **工时核对** | `checkIntegrity()` | 完整性检查 |
| | `checkCompliance()` | 合规性检查 |
| | `getCheckHistory()` | 获取核对历史 |
| | `getCheckDetail()` | 获取核对详情 |
| | `downloadCheckReport()` | 下载核对报告 |
| **系统设置** | `backupData()` | 数据备份 |
| | `restoreData()` | 数据恢复 |

### 模拟数据位置

所有模拟数据定义在 **`src/api/index.js`** 文件中：

| 数据类型 | 位置 | 内容 |
|---------|------|------|
| 用户数据 | 第 5-8 行 | `mockUsers` 数组（admin、user） |
| 数据字典 | 第 11-20 行 | `mockDataDict`（项目、部门、用户列表） |
| 导入结果 | `importExcel()` 函数内 | 100 行数据，95 成功，3 重复，2 无效 |
| 项目查询 | `queryByProject()` 内 | 2 条模拟工时记录 |
| 组织查询 | `queryByOrganization()` 内 | 2 条模拟工时记录 |
| 完整性检查 | `checkIntegrity()` 内 | 缺失工时统计数据 |
| 合规性检查 | `checkCompliance()` 内 | 异常工时数据统计 |
| 导入记录 | `getImportRecords()` 内 | 2 条历史批次记录 |

### HTTP 请求配置

**配置文件**：`src/utils/request.js`

| 配置项 | 值 |
|--------|-----|
| 基础 URL | `http://localhost:8000/api` |
| 超时时间 | 30 秒 |
| 认证方式 | JWT Bearer Token |
| Token 存储 | localStorage |

**请求拦截器**：
- 自动添加 Authorization 头（Bearer Token）

**响应拦截器**：
- 统一处理错误码（401、403、500 等）
- 401 时自动跳转登录页

### 数据交互流程

```
┌─────────────┐    ┌──────────────┐    ┌─────────────┐
│  Views.vue  │───▶│  api/index.js │───▶│ request.js  │
│  (页面组件)  │    │  (API 封装)   │    │  (Axios)    │
└─────────────┘    └──────────────┘    └─────────────┘
                          │
                          ▼
                   ┌──────────────┐
                   │ MOCK_MODE 判断│
                   └──────────────┘
                          │
              ┌───────────┴───────────┐
              ▼                       ▼
         ┌────────┐            ┌──────────┐
         │  true  │            │  false   │
         └────┬───┘            └────┬─────┘
              │                     │
              ▼                     ▼
    ┌───────────────┐     ┌────────────────┐
    │ 返回模拟数据    │     │ HTTP 请求到后端  │
    │Promise.resolve │  │ localhost:8000 │
    └───────────────┘     └────────────────┘
```

### 统一响应格式

所有 API 接口遵循统一的响应格式：

```javascript
{
  code: 200,           // 状态码
  message: '操作成功',  // 提示信息
  data: {...}          // 业务数据
}
```

### 关键设计特点

1. **无后端可运行** - 默认开启模拟模式，可直接体验所有功能
2. **统一响应格式** - 所有接口返回 `{code, message, data}`
3. **JWT 认证模拟** - 自动生成假 token，存储在 localStorage
4. **错误处理完整** - 包含网络错误、业务错误的模拟

### 关键代码位置索引

| 功能模块 | 关键文件 | 位置 |
|---------|---------|------|
| API 接口定义 | `src/api/index.js` | 所有业务接口 |
| HTTP 请求封装 | `src/utils/request.js` | Axios 配置和拦截器 |
| 用户状态管理 | `src/store/index.js` | Pinia store |
| 路由守卫 | `src/router/index.js` | 未登录拦截 |

---

## 版本历史

### v1.2 (2026-01-15)
- 新增 API 实现说明章节，详细描述双模式设计
- 补充模拟数据位置和内容说明
- 添加数据交互流程图

### v1.1 (2026-01-15)
- 添加模拟登录模式，无需后端即可体验完整功能
- 更新使用文档，补充模拟模式说明

### v1.0 (2026-01-15)
- 初始原型生成
- 包含所有核心功能模块（数据导入、工时查询、工时核对、系统设置）
- 完整的页面布局和交互逻辑
- 响应式设计，适配主流浏览器

---

**提示**：如需求变更导致原型更新，请更新本 README 的"版本历史"部分，并同步通知开发团队。
